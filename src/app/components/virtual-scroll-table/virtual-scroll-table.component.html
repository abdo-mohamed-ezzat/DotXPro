<div class="virtual-scroll-container">
  <cdk-virtual-scroll-viewport #viewPort  [itemSize]="40"  class="viewport" (scrolledIndexChange)="onScrollIndexChange($event)" style="height: 500px;">
    <table mat-table #table [dataSource]="dataSource">
      <ng-container
      *ngFor="let col of columnDefs"
        [matColumnDef]="col.field"
        class="item"
      >
        <th mat-header-cell *matHeaderCellDef [style.top.px]="offset">
          {{ col.displayName }}
        </th>
        <td mat-cell *matCellDef="let row">{{ row[col.field] }}</td>
      </ng-container>
  
      <tr
        mat-header-row
        *matHeaderRowDef="displayedColumns; sticky: true"
        [style.top.px]="offset"
      ></tr>
  
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>
  </cdk-virtual-scroll-viewport>
</div>

<!-- <div class="virtual-scroll-container">
  <cdk-virtual-scroll-viewport #viewPort [itemSize]="ITEM_SIZE" class="viewport" (scrolledIndexChange)="onScrollIndexChange($event)">
    <table #table>
      <thead  [style.top.px]="offset">
        <tr>
          <ng-container *ngFor="let col of columnDefs">
            <th *ngIf="!col['hide']">{{ col.displayName }}</th>
          </ng-container>
        </tr>
      </thead>
      <tbody>
        <tr *cdkVirtualFor="let row of dataSource; let i = index" class="item">
          <ng-container *ngFor="let col of columnDefs">
            <td *ngIf="!col['hide']">{{ row[col.field] }}</td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </cdk-virtual-scroll-viewport>
</div> -->


