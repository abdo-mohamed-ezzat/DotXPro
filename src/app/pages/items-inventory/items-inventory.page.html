<ion-header [translucent]="true" class="ion-no-border page-header">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-menu-toggle auto-hide="false" side="end">
        <ion-button>
          <ion-icon name="menu"></ion-icon>
        </ion-button>
      </ion-menu-toggle>
    </ion-buttons>
    <ion-title class="ion-text-center header-title-align"
      >مخزون الأصناف</ion-title
    >
  </ion-toolbar>
</ion-header>

<ion-content>
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
    <path
      fill="#1d4188"
      fill-opacity="1"
      d="M0,256L60,218.7C120,181,240,107,360,85.3C480,64,600,96,720,138.7C840,181,960,235,1080,261.3C1200,288,1320,288,1380,288L1440,288L1440,0L1380,0C1320,0,1200,0,1080,0C960,0,840,0,720,0C600,0,480,0,360,0C240,0,120,0,60,0L0,0Z"
    ></path>
  </svg>
  <ion-grid class="content-grid">
    <ion-row>
      <ion-col>
        <ion-radio-group
          [(ngModel)]="itemName"
          [allowEmptySelection]="false"
          (ionChange)="onTypeOfReportChange($event)"
        >
          <ion-radio value="كافة الاصناف" labelPlacement="end"
            ><h2>كافة الأصناف</h2></ion-radio
          >
          <ion-radio value="صنف واحد" labelPlacement="end"
            ><h2>صنف واحد</h2></ion-radio
          >
        </ion-radio-group>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12" *ngIf="itemName !== 'كافة الاصناف'">
        <div>
          <form class="form">
            <mat-form-field class="width">
              <input
                matInput
                placeholder="اسم الصنف"
                aria-label="اسم الصنف"
                [matAutocomplete]="auto"
                [formControl]="itemsCtrl"
                required
              />
              <mat-error *ngIf="itemsCtrl.invalid"> اسم الصنف طلوب </mat-error>
              <mat-autocomplete
                #auto="matAutocomplete"
                (optionSelected)="setOneItemValueOption($event)"
              >
                <cdk-virtual-scroll-viewport itemSize="20" class="viewport">
                  <mat-option
                    class="vscr-item"
                    *cdkVirtualFor="let item of filteredItems | async"
                    [value]="item.value"
                  >
                    <span>{{ item.value}}</span>
                  </mat-option>
                </cdk-virtual-scroll-viewport>
              </mat-autocomplete>
            </mat-form-field>
          </form>
        </div>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col>
        <ion-button id="open-modal">
          <ion-icon name="filter-outline"></ion-icon>
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
  <div class="table-wrapper">
    <ion-grid
      class="table"
      [ngStyle]="{'height': itemName !== 'كافة الاصناف' ? 'calc(100vh - 420px)' : 'calc(100vh - 319px)'}"
    >
      <ion-row class="table-header">
        <ion-col style="min-width: 150px;">
          <span>الصنف</span>
        </ion-col>
        <ion-col>
          <span>رقم الصنف</span>
        </ion-col>
        <ion-col>
          <span>الماركة</span>
        </ion-col>
        <ion-col>
          <span>الكمية المتوفرة</span>
        </ion-col>
        <ion-col>
          <span>الوحدة الصغرى</span>
        </ion-col>
        <ion-col>
          <span>تكلفة الوجدة</span>
        </ion-col>
        <ion-col>
          <span>اجمالي التكلفة</span>
        </ion-col>
        <ion-col>
          <span>تاريخ اخر حركة</span>
        </ion-col>
        <ion-col>
          <span>المخزن</span>
        </ion-col>
      </ion-row>
      <ion-row class="table-row" *ngFor="let account of itemsInverntoryReport">
        <ion-col style="min-width: 150px;">
          <span>{{account.itemName}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.itemNumber}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.brandName}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.stockQuantity | number:'1.2-2'}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.unitName}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.stockUnitCost | number:'1.2-2'}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.stockTotalCost | number:'1.2-2'}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.theDate | date}}</span>
        </ion-col>
        <ion-col>
          <span>{{account.storeName}}</span>
        </ion-col>
      </ion-row>
      <ion-row class="table-footer" class="table-footer">
        <ion-col style="min-width: 150px;">
          <span>الاجمالي</span>
        </ion-col>
        <ion-col></ion-col>
        <ion-col></ion-col>
        <ion-col>
          <span>{{ totalStockQuantity | number:'1.2-2' }}</span>
        </ion-col>
        <ion-col></ion-col>
        <ion-col>
          <span>{{ totalStockUnitCost | number:'1.2-2' }}</span>
        </ion-col>
        <ion-col>
          <span>{{ totalStockTotalCost | number:'1.2-2' }}</span>
        </ion-col>
        <ion-col></ion-col>
        <ion-col></ion-col>
      </ion-row>
    </ion-grid>
  </div>
  
  <app-spinner *ngIf="loading"></app-spinner>
</ion-content>
<ion-modal
  #modal
  trigger="open-modal"
  [initialBreakpoint]="1"
  [breakpoints]="[0, 0.75, 1]"
>
  <ng-template>
    <ion-content>
      <form [formGroup]="filterForm" (ngSubmit)="applyFilter()">
        <div class="options-section">
          <h2>اسم المخزن</h2>
          <app-select-chips
            [selectOptions]="storeOptions"
            (selectedOption)="setInventoryName($event)"
            [allowedMultiClick]="true"
          ></app-select-chips>
        </div>
        <div class="options-section">
          <h2>الفترة</h2>
          <app-select-chips [selectOptions]="timeOptinos"></app-select-chips>
          <app-date-input (toDateEmit)="handleToDate($event)"></app-date-input>
        </div>
        <div class="options-section">
          <ion-toggle
            labelPlacement="start"
            toggle-alignment-baseline
            formControlName="isInTheStock"
            ><h2>إظهار الكمية الصفرية</h2></ion-toggle
          >
          <ion-toggle
            labelPlacement="start"
            toggle-alignment-baseline
            formControlName="isBeforeRelay"
            ><h2>قبل الترحيل</h2></ion-toggle
          >
        </div>
        <div class="submit-button-container">
          <ion-button color="primary" size="large" shape="round" type="submit"
            >تطبيق</ion-button
          >
        </div>
      </form>
    </ion-content>
  </ng-template>
</ion-modal>
